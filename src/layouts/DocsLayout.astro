---
import { ViewTransitions } from "astro:transitions";
import "@styles/base.css";

interface NavItem {
    label: string;
    href: string;
    badge?: string;
}

interface NavSection {
    title: string;
    items: NavItem[];
}

interface Props {
    title: string;
    description?: string;
    currentSection: "components" | "styles" | "effects" | "web-components";
    currentPage?: string;
    sidebar: NavSection[];
}

const { title, description, currentSection, currentPage, sidebar } = Astro.props;

const mainNavSections = [
    { id: "home", href: "/", label: "Home" },
    { id: "components", href: "/components", label: "Components" },
    { id: "styles", href: "/styles", label: "Styles" },
    { id: "effects", href: "/effects", label: "Effects" },
    { id: "web-components", href: "/web-components", label: "Web Components" },
    { id: "admin", href: "/admin", label: "Admin Demo" },
];

const sectionColors: Record<string, { gradient: string; accent: string }> = {
    components: { gradient: "from-violet-500 to-purple-600", accent: "violet" },
    styles: { gradient: "from-fuchsia-500 to-pink-600", accent: "fuchsia" },
    effects: { gradient: "from-cyan-500 to-blue-600", accent: "cyan" },
    "web-components": { gradient: "from-emerald-500 to-teal-600", accent: "emerald" }
};

const colors = sectionColors[currentSection];
---

<!doctype html>
<html lang="de" class="dark">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content={description || "Atlas UI Documentation"} />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <title>{title} - Atlas UI</title>
        <ViewTransitions />
        <script
            is:inline
            src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.4/dist/htmx.min.js"
        ></script>
        <script
            is:inline
            defer
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.0/dist/cdn.min.js"
        ></script>
    </head>
    <body class="min-h-screen bg-[#0a0a1a] text-white">
        <!-- Ambient Background -->
        <div class="fixed inset-0 overflow-hidden pointer-events-none">
            <div class="absolute top-0 left-1/4 w-[600px] h-[600px] bg-violet-500/5 rounded-full blur-[120px]"></div>
            <div class="absolute bottom-0 right-1/4 w-[500px] h-[500px] bg-fuchsia-500/5 rounded-full blur-[100px]"></div>
        </div>

        <div class="relative min-h-screen flex flex-col">
            <!-- Header -->
            <header class="sticky top-0 z-50 backdrop-blur-xl bg-[#0a0a1a]/80 border-b border-white/5">
                <div class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex items-center justify-between h-16">
                        <!-- Logo -->
                        <a href="/" class="flex items-center gap-3 group">
                            <div class={`w-10 h-10 rounded-xl bg-gradient-to-br ${colors.gradient} flex items-center justify-center shadow-lg`}>
                                <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                                </svg>
                            </div>
                            <div>
                                <span class="text-xl font-bold text-white">Atlas UI</span>
                                <span class="hidden sm:inline text-xs text-gray-500 ml-2">Docs</span>
                            </div>
                        </a>

                        <!-- Desktop Navigation -->
                        <nav class="hidden lg:flex items-center gap-1">
                            {mainNavSections.map((section) => (
                                <a
                                    href={section.href}
                                    class:list={[
                                        "px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200",
                                        currentSection === section.id
                                            ? "bg-white/10 text-white"
                                            : "text-gray-400 hover:text-white hover:bg-white/5"
                                    ]}
                                >
                                    {section.label}
                                </a>
                            ))}
                        </nav>

                        <!-- Actions -->
                        <div class="flex items-center gap-4">
                            <a
                                href="https://github.com/casoon/atlas"
                                target="_blank"
                                rel="noopener"
                                class="hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-lg bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white transition-all duration-200"
                            >
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
                                </svg>
                            </a>

                            <!-- Mobile Menu Button -->
                            <button
                                x-data
                                @click="$dispatch('toggle-sidebar')"
                                class="lg:hidden p-2 rounded-lg hover:bg-white/10 transition-colors"
                            >
                                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <div class="flex-1 flex">
                <!-- Sidebar -->
                <aside
                    x-data="{ open: false }"
                    @toggle-sidebar.window="open = !open"
                    class="fixed lg:sticky top-16 z-40 w-72 h-[calc(100vh-4rem)] flex-shrink-0"
                >
                    <!-- Mobile Overlay -->
                    <div
                        x-show="open"
                        x-transition:enter="transition-opacity ease-out duration-200"
                        x-transition:enter-start="opacity-0"
                        x-transition:enter-end="opacity-100"
                        x-transition:leave="transition-opacity ease-in duration-150"
                        x-transition:leave-start="opacity-100"
                        x-transition:leave-end="opacity-0"
                        @click="open = false"
                        class="fixed inset-0 bg-black/50 lg:hidden"
                    ></div>

                    <!-- Sidebar Content -->
                    <nav
                        x-show="open || window.innerWidth >= 1024"
                        x-transition:enter="transition ease-out duration-200"
                        x-transition:enter-start="-translate-x-full"
                        x-transition:enter-end="translate-x-0"
                        x-transition:leave="transition ease-in duration-150"
                        x-transition:leave-start="translate-x-0"
                        x-transition:leave-end="-translate-x-full"
                        class="absolute lg:relative w-full h-full bg-[#0a0a1a] lg:bg-transparent border-r border-white/5 overflow-y-auto p-6"
                    >
                        {sidebar.map((section) => (
                            <div class="mb-6">
                                <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">
                                    {section.title}
                                </h3>
                                <ul class="space-y-1">
                                    {section.items.map((item) => (
                                        <li>
                                            <a
                                                href={item.href}
                                                class:list={[
                                                    "flex items-center justify-between px-3 py-2 rounded-lg text-sm transition-all duration-200",
                                                    currentPage === item.href
                                                        ? `bg-${colors.accent}-500/10 text-${colors.accent}-400 border-l-2 border-${colors.accent}-400`
                                                        : "text-gray-400 hover:text-white hover:bg-white/5"
                                                ]}
                                            >
                                                <span>{item.label}</span>
                                                {item.badge && (
                                                    <span class={`px-2 py-0.5 rounded-full text-xs bg-${colors.accent}-500/20 text-${colors.accent}-400`}>
                                                        {item.badge}
                                                    </span>
                                                )}
                                            </a>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        ))}
                    </nav>
                </aside>

                <!-- Main Content -->
                <main class="flex-1 min-w-0 p-6 lg:p-10" transition:animate="fade">
                    <div class="max-w-4xl">
                        <slot />
                    </div>
                </main>
            </div>
        </div>

        <!-- Atlas Initialization -->
        <script>
            import { atlasInit } from "@casoon/atlas-components";

            function initAtlas() {
                atlasInit();
            }

            document.addEventListener("DOMContentLoaded", initAtlas);
            document.addEventListener("astro:page-load", initAtlas);
        </script>
    </body>
</html>
