---
import PartialWrapper from "@components/PartialWrapper.astro";

const isPartial = Astro.url.searchParams.get("partial") === "true";
---

<PartialWrapper title="New Effects" currentPage="effects-new" isPartial={isPartial}>
    <div class="space-y-8">
        <div>
            <h2 class="text-xl sm:text-2xl font-bold text-white">New Effects</h2>
            <p class="text-white/50 text-sm mt-1">Atlas Effects 0.2.0 - Gestures, Theme Transitions, Scroll Effects & more</p>
        </div>

        <!-- Theme Transition -->
        <section class="cs-glass-card p-5 sm:p-6">
            <h3 class="font-semibold text-white mb-4">Theme Transition</h3>
            <p class="text-white/50 text-sm mb-6">Circular reveal animation for dark/light mode switching</p>

            <div class="flex gap-4">
                <button id="theme-toggle-circle"
                    class="px-4 py-2.5 bg-gradient-to-r from-violet-500 to-fuchsia-500 text-white text-sm font-medium rounded-xl shadow-lg shadow-violet-500/25 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                    </svg>
                    Circle Reveal
                </button>
                <button id="theme-toggle-fade"
                    class="px-4 py-2.5 bg-white/10 border border-white/20 text-white text-sm font-medium rounded-xl flex items-center gap-2 hover:bg-white/20 transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                    Fade Transition
                </button>
            </div>

            <div class="mt-4 bg-black/30 rounded-lg p-3 font-mono text-xs text-white/60 overflow-x-auto">
                <code>import {'{ createThemeTransition }'} from '@casoon/atlas-effects';</code><br/>
                <code>const theme = createThemeTransition({'{ effect: "circle", origin: button }'});</code><br/>
                <code>theme.toggle();</code>
            </div>
        </section>

        <!-- Gesture Detection -->
        <section class="cs-glass-card p-5 sm:p-6">
            <h3 class="font-semibold text-white mb-4">Gesture Detection</h3>
            <p class="text-white/50 text-sm mb-6">Touch & pointer gestures - Swipe, Pinch, Long Press, Pan</p>

            <div id="gesture-area"
                class="h-48 rounded-2xl bg-gradient-to-br from-violet-500/10 to-fuchsia-500/10 border-2 border-dashed border-white/20 flex flex-col items-center justify-center gap-4 select-none touch-none">
                <div class="text-white/50 text-sm">Try gestures here (touch or mouse)</div>
                <div id="gesture-output" class="text-lg font-semibold text-white">Waiting for gesture...</div>
                <div class="flex gap-2 text-xs text-white/40">
                    <span class="px-2 py-1 rounded bg-white/10">Swipe</span>
                    <span class="px-2 py-1 rounded bg-white/10">Long Press</span>
                    <span class="px-2 py-1 rounded bg-white/10">Pan</span>
                </div>
            </div>

            <div class="mt-4 bg-black/30 rounded-lg p-3 font-mono text-xs text-white/60 overflow-x-auto">
                <code>import {'{ createGesture }'} from '@casoon/atlas-effects';</code><br/>
                <code>createGesture(element, {'{'}</code><br/>
                <code>  onSwipe: ({'{ direction }'}) => console.log(direction),</code><br/>
                <code>  onLongPress: () => console.log('Long press!')</code><br/>
                <code>{'}'});</code>
            </div>
        </section>

        <!-- Scroll Effects -->
        <section class="cs-glass-card p-5 sm:p-6">
            <h3 class="font-semibold text-white mb-4">Scroll Effects</h3>
            <p class="text-white/50 text-sm mb-6">scrollProgress, parallaxLayer, textSplit, scrollCounter</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Scroll Progress Demo -->
                <div class="p-4 rounded-xl bg-white/[0.03] border border-white/[0.08]">
                    <h4 class="font-medium text-white mb-3">Scroll Progress</h4>
                    <div class="relative h-2 rounded-full bg-white/10 overflow-hidden">
                        <div id="scroll-progress-bar" class="absolute inset-y-0 left-0 bg-gradient-to-r from-violet-500 to-fuchsia-500 rounded-full transition-all duration-100"
                            style="width: 0%"></div>
                    </div>
                    <p class="text-xs text-white/40 mt-2">Scroll the page to see progress</p>
                </div>

                <!-- Scroll Counter -->
                <div class="p-4 rounded-xl bg-white/[0.03] border border-white/[0.08]">
                    <h4 class="font-medium text-white mb-3">Scroll Counter</h4>
                    <div class="flex items-baseline gap-1">
                        <span id="scroll-counter" class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400">0</span>
                        <span class="text-white/40">users</span>
                    </div>
                    <p class="text-xs text-white/40 mt-2">Animates to 12,500 on scroll</p>
                </div>
            </div>
        </section>

        <!-- Text Scramble Effect -->
        <section class="cs-glass-card p-5 sm:p-6">
            <h3 class="font-semibold text-white mb-4">Text Scramble</h3>
            <p class="text-white/50 text-sm mb-6">Matrix-style text reveal animation</p>

            <div class="flex flex-col items-center gap-6">
                <div id="scramble-text" class="text-2xl sm:text-3xl font-bold text-white font-mono tracking-wider">
                    ATLAS EFFECTS
                </div>
                <button id="scramble-trigger"
                    class="px-4 py-2.5 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white text-sm font-medium rounded-xl shadow-lg shadow-emerald-500/25">
                    Trigger Scramble
                </button>
            </div>
        </section>

        <!-- Shimmer Effect -->
        <section class="cs-glass-card p-5 sm:p-6">
            <h3 class="font-semibold text-white mb-4">Shimmer Effect</h3>
            <p class="text-white/50 text-sm mb-6">Shine sweep animation for buttons and cards</p>

            <div class="flex flex-wrap gap-4">
                <button id="shimmer-button"
                    class="relative overflow-hidden px-6 py-3 bg-gradient-to-r from-violet-500 to-fuchsia-500 text-white text-sm font-medium rounded-xl shadow-lg shadow-violet-500/25">
                    <span class="relative z-10">Hover for Shimmer</span>
                    <div class="shimmer-overlay absolute inset-0 -translate-x-full bg-gradient-to-r from-transparent via-white/30 to-transparent skew-x-12"></div>
                </button>

                <div id="shimmer-card" class="relative overflow-hidden p-4 rounded-xl bg-white/[0.05] border border-white/[0.08] w-48">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-500"></div>
                        <div>
                            <div class="text-sm font-medium text-white">Card Title</div>
                            <div class="text-xs text-white/40">Hover me</div>
                        </div>
                    </div>
                    <div class="shimmer-overlay absolute inset-0 -translate-x-full bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12"></div>
                </div>
            </div>
        </section>

        <!-- Spotlight Effect -->
        <section class="cs-glass-card p-5 sm:p-6">
            <h3 class="font-semibold text-white mb-4">Spotlight Effect</h3>
            <p class="text-white/50 text-sm mb-6">Cursor-following spotlight/highlight</p>

            <div id="spotlight-area"
                class="relative h-48 rounded-2xl bg-gradient-to-br from-slate-900 to-slate-800 border border-white/[0.08] overflow-hidden flex items-center justify-center">
                <div class="text-center z-10">
                    <h4 class="text-xl font-bold text-white mb-2">Move your cursor</h4>
                    <p class="text-white/50 text-sm">Spotlight follows mouse movement</p>
                </div>
                <div id="spotlight" class="absolute w-64 h-64 rounded-full pointer-events-none opacity-0 transition-opacity duration-300"
                    style="background: radial-gradient(circle, rgba(139, 92, 246, 0.3) 0%, transparent 70%);"></div>
            </div>
        </section>

        <!-- Glitch Effect -->
        <section class="cs-glass-card p-5 sm:p-6">
            <h3 class="font-semibold text-white mb-4">Glitch Effect</h3>
            <p class="text-white/50 text-sm mb-6">Digital glitch with RGB shift and scanlines</p>

            <div class="flex flex-col items-center gap-6">
                <div id="glitch-text" class="relative text-3xl sm:text-4xl font-bold text-white">
                    <span class="glitch-text" data-text="GLITCH">GLITCH</span>
                </div>
                <button id="glitch-trigger"
                    class="px-4 py-2.5 bg-gradient-to-r from-rose-500 to-orange-500 text-white text-sm font-medium rounded-xl shadow-lg shadow-rose-500/25">
                    Trigger Glitch
                </button>
            </div>
        </section>

        <!-- Film Grain -->
        <section class="cs-glass-card p-5 sm:p-6">
            <h3 class="font-semibold text-white mb-4">Film Grain Overlay</h3>
            <p class="text-white/50 text-sm mb-6">Animated film grain/noise texture</p>

            <div class="flex flex-wrap gap-4" x-data="{ grainActive: false }">
                <button @click="grainActive = !grainActive" id="grain-toggle"
                    :class="grainActive ? 'bg-emerald-500' : 'bg-white/10 border border-white/20'"
                    class="px-4 py-2.5 text-white text-sm font-medium rounded-xl transition-colors">
                    <span x-text="grainActive ? 'Grain ON' : 'Grain OFF'"></span>
                </button>

                <div class="text-sm text-white/40 flex items-center">
                    Presets:
                    <button class="ml-2 px-2 py-1 rounded bg-white/10 hover:bg-white/20 transition-colors">Subtle</button>
                    <button class="ml-1 px-2 py-1 rounded bg-white/10 hover:bg-white/20 transition-colors">Film</button>
                    <button class="ml-1 px-2 py-1 rounded bg-white/10 hover:bg-white/20 transition-colors">Vintage</button>
                </div>
            </div>

            <div class="mt-4 bg-black/30 rounded-lg p-3 font-mono text-xs text-white/60 overflow-x-auto">
                <code>import {'{ createGrain, grainPresets }'} from '@casoon/atlas-effects';</code><br/>
                <code>const grain = createGrain(grainPresets.film);</code><br/>
                <code>grain.show(); // grain.hide();</code>
            </div>
        </section>

        <!-- fx Composition API -->
        <section class="cs-glass-card p-5 sm:p-6">
            <h3 class="font-semibold text-white mb-4">fx - Effect Composition API</h3>
            <p class="text-white/50 text-sm mb-6">Chain multiple effects with a fluent builder</p>

            <div id="fx-demo-card" data-atlas="card" data-hover="lift"
                class="p-6 rounded-xl bg-gradient-to-br from-violet-500/20 to-fuchsia-500/20 border border-white/[0.08] max-w-md">
                <h4 class="font-semibold text-white mb-2">Combined Effects</h4>
                <p class="text-sm text-white/50">This card has ripple + tilt + glow combined via fx()</p>
            </div>

            <div class="mt-4 bg-black/30 rounded-lg p-3 font-mono text-xs text-white/60 overflow-x-auto">
                <code>import {'{ fx, ripple, tilt, glow }'} from '@casoon/atlas-effects';</code><br/><br/>
                <code>const cleanup = fx('#my-card')</code><br/>
                <code>  .add(ripple())</code><br/>
                <code>  .add(tilt({'{ max: 15 }'}))</code><br/>
                <code>  .add(glow({'{ color: "violet" }'}))</code><br/>
                <code>  .apply();</code>
            </div>
        </section>

        <!-- View Transitions API -->
        <section class="cs-glass-card p-5 sm:p-6">
            <h3 class="font-semibold text-white mb-4">View Transitions API</h3>
            <p class="text-white/50 text-sm mb-6">Modern page/state transitions with shared element morphing</p>

            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                <div id="morph-thumb-1" class="cursor-pointer group">
                    <div class="aspect-square rounded-xl bg-gradient-to-br from-violet-500 to-fuchsia-500 flex items-center justify-center text-white font-bold text-2xl
                        group-hover:scale-105 transition-transform">1</div>
                    <p class="text-xs text-white/40 mt-2 text-center">Click to expand</p>
                </div>
                <div id="morph-thumb-2" class="cursor-pointer group">
                    <div class="aspect-square rounded-xl bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center text-white font-bold text-2xl
                        group-hover:scale-105 transition-transform">2</div>
                    <p class="text-xs text-white/40 mt-2 text-center">Click to expand</p>
                </div>
                <div id="morph-thumb-3" class="cursor-pointer group">
                    <div class="aspect-square rounded-xl bg-gradient-to-br from-rose-500 to-orange-500 flex items-center justify-center text-white font-bold text-2xl
                        group-hover:scale-105 transition-transform">3</div>
                    <p class="text-xs text-white/40 mt-2 text-center">Click to expand</p>
                </div>
                <div id="morph-thumb-4" class="cursor-pointer group">
                    <div class="aspect-square rounded-xl bg-gradient-to-br from-amber-500 to-yellow-500 flex items-center justify-center text-white font-bold text-2xl
                        group-hover:scale-105 transition-transform">4</div>
                    <p class="text-xs text-white/40 mt-2 text-center">Click to expand</p>
                </div>
            </div>

            <div class="mt-4 bg-black/30 rounded-lg p-3 font-mono text-xs text-white/60 overflow-x-auto">
                <code>import {'{ startViewTransition, sharedElementTransition }'} from '@casoon/atlas-effects';</code><br/>
                <code>await sharedElementTransition(thumbnail, fullImage, {'{ name: "hero" }'});</code>
            </div>
        </section>
    </div>
</PartialWrapper>

<script>
    import { atlasInit } from "@casoon/atlas-components";
    import {
        createGesture,
        textScramble,
        shimmer,
        spotlight,
        glitch,
        scrollProgress
    } from "@casoon/atlas-effects";

    function initEffects() {
        // Gesture Detection
        const gestureArea = document.getElementById('gesture-area');
        const gestureOutput = document.getElementById('gesture-output');

        if (gestureArea && gestureOutput) {
            createGesture(gestureArea, {
                swipe: true,
                longPress: { duration: 500 },
                pan: true,
                onSwipe: ({ direction }) => {
                    gestureOutput.textContent = `Swiped ${direction}!`;
                    gestureOutput.classList.add('text-violet-400');
                    setTimeout(() => {
                        gestureOutput.classList.remove('text-violet-400');
                        gestureOutput.textContent = 'Waiting for gesture...';
                    }, 1500);
                },
                onLongPress: () => {
                    gestureOutput.textContent = 'Long press detected!';
                    gestureOutput.classList.add('text-emerald-400');
                    setTimeout(() => {
                        gestureOutput.classList.remove('text-emerald-400');
                        gestureOutput.textContent = 'Waiting for gesture...';
                    }, 1500);
                },
                onPan: ({ delta }) => {
                    gestureOutput.textContent = `Panning: ${Math.round(delta.x)}, ${Math.round(delta.y)}`;
                }
            });
        }

        // Text Scramble
        const scrambleText = document.getElementById('scramble-text');
        const scrambleTrigger = document.getElementById('scramble-trigger');

        if (scrambleText && scrambleTrigger) {
            scrambleTrigger.addEventListener('click', () => {
                textScramble(scrambleText, {
                    text: 'ATLAS EFFECTS',
                    speed: 50,
                    iterations: 8
                });
            });
        }

        // Shimmer on hover
        const shimmerButton = document.getElementById('shimmer-button');
        const shimmerCard = document.getElementById('shimmer-card');

        [shimmerButton, shimmerCard].forEach(el => {
            if (el) {
                const overlay = el.querySelector('.shimmer-overlay');
                if (overlay) {
                    el.addEventListener('mouseenter', () => {
                        overlay.style.transition = 'transform 0.6s ease';
                        overlay.style.transform = 'translateX(200%)';
                    });
                    el.addEventListener('mouseleave', () => {
                        overlay.style.transition = 'none';
                        overlay.style.transform = 'translateX(-100%)';
                    });
                }
            }
        });

        // Spotlight
        const spotlightArea = document.getElementById('spotlight-area');
        const spotlightEl = document.getElementById('spotlight');

        if (spotlightArea && spotlightEl) {
            spotlightArea.addEventListener('mouseenter', () => {
                spotlightEl.style.opacity = '1';
            });
            spotlightArea.addEventListener('mouseleave', () => {
                spotlightEl.style.opacity = '0';
            });
            spotlightArea.addEventListener('mousemove', (e) => {
                const rect = spotlightArea.getBoundingClientRect();
                const x = e.clientX - rect.left - 128;
                const y = e.clientY - rect.top - 128;
                spotlightEl.style.transform = `translate(${x}px, ${y}px)`;
            });
        }

        // Glitch
        const glitchText = document.getElementById('glitch-text');
        const glitchTrigger = document.getElementById('glitch-trigger');

        if (glitchText && glitchTrigger) {
            glitchTrigger.addEventListener('click', () => {
                glitchText.classList.add('glitching');
                setTimeout(() => {
                    glitchText.classList.remove('glitching');
                }, 500);
            });
        }

        // Scroll Progress
        const scrollProgressBar = document.getElementById('scroll-progress-bar');
        if (scrollProgressBar) {
            const updateProgress = () => {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const progress = (scrollTop / docHeight) * 100;
                scrollProgressBar.style.width = `${Math.min(100, Math.max(0, progress))}%`;
            };
            window.addEventListener('scroll', updateProgress, { passive: true });
            updateProgress();
        }

        // Scroll Counter (simple version)
        const scrollCounter = document.getElementById('scroll-counter');
        if (scrollCounter) {
            let animated = false;
            const animateCounter = () => {
                if (animated) return;
                const rect = scrollCounter.getBoundingClientRect();
                if (rect.top < window.innerHeight && rect.bottom > 0) {
                    animated = true;
                    let current = 0;
                    const target = 12500;
                    const duration = 2000;
                    const step = target / (duration / 16);

                    const animate = () => {
                        current += step;
                        if (current >= target) {
                            scrollCounter.textContent = target.toLocaleString();
                        } else {
                            scrollCounter.textContent = Math.floor(current).toLocaleString();
                            requestAnimationFrame(animate);
                        }
                    };
                    animate();
                }
            };
            window.addEventListener('scroll', animateCounter, { passive: true });
            animateCounter();
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        atlasInit();
        initEffects();
    });
    document.addEventListener("astro:page-load", () => {
        atlasInit();
        initEffects();
    });
</script>

<style>
    [x-cloak] { display: none !important; }

    /* Glitch Effect Styles */
    .glitch-text {
        position: relative;
    }

    .glitching .glitch-text::before,
    .glitching .glitch-text::after {
        content: attr(data-text);
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    .glitching .glitch-text::before {
        animation: glitch-1 0.2s infinite;
        color: #ff00ff;
        clip-path: polygon(0 0, 100% 0, 100% 35%, 0 35%);
    }

    .glitching .glitch-text::after {
        animation: glitch-2 0.2s infinite;
        color: #00ffff;
        clip-path: polygon(0 65%, 100% 65%, 100% 100%, 0 100%);
    }

    @keyframes glitch-1 {
        0%, 100% { transform: translateX(0); }
        20% { transform: translateX(-5px); }
        40% { transform: translateX(5px); }
        60% { transform: translateX(-3px); }
        80% { transform: translateX(3px); }
    }

    @keyframes glitch-2 {
        0%, 100% { transform: translateX(0); }
        20% { transform: translateX(5px); }
        40% { transform: translateX(-5px); }
        60% { transform: translateX(3px); }
        80% { transform: translateX(-3px); }
    }
</style>
